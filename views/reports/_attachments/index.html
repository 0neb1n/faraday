<!-- Faraday Penetration Test IDE &#45; Community Version -->
<!-- Copyright (C) 2013  Infobyte LLC (http://www.infobytesec.com/) -->
<!-- See the file 'doc/LICENSE' for the license information -->
<!DOCTYPE html>   
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8"/>
	<!--[if IE]><![endif]-->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<title>Dashboard | Faraday</title>
	<meta name="description" content=""/>
	<meta name="keywords" content=""/>
	<meta name="author" content=""/>

	<!-- !CSS -->
	<link rel="stylesheet" type="text/css" href="estilos.css" />
	
	<link href="favicon.ico" rel="shortcut icon">
	<link href="favicon.ico" type="image/vnd.microsoft.icon" rel="icon" />
	<link href="images/site_preview.jpg" rel="image_src" />

	<script type="text/javascript" src="/_utils/script/sha1.js"></script>
	<script type="text/javascript" src="script/app.js"></script>
	<script type="text/javascript" src="script/reports_list.js"></script>
	<script type="text/javascript" src="/_utils/script/json2.js"></script>
	<script type="text/javascript" src="/_utils/script/jquery.js"></script>
	<script type="text/javascript" src="/_utils/script/jquery.couch.js"></script>
	<script type="text/javascript" src="script/jquery.tablesorter.min.js"></script>
	<script type="text/javascript" src="script/jquery.ui.tabs.min.js"></script>
</head>

<body>
	<div id="cont">
		<div class="wrapper">
			<header class="head">
				<a href="#"><img class="logo" src="images/logo-faraday.png"/></a>
			</header>
			
			<aside>
				<nav>
					<ul>
						<li>
							<a href="#"><img src="images/ico-settings.png" alt="Commercial version only"/></a>
							<a href="#" class="activo"><img src="images/ico-graph.png" alt=""/></a>
							<a href="#"><img src="images/ico-stopwatch.png" alt="Commercial version only"/></a>
						</li>
					</ul>
				</nav>
			</aside>
			
			<section id="sec" class="clearfix">
				<ul id="nav"></ul><!-- navegacion de WS -->
			</section><!-- #main -->
			<section id="main" class="seccion clearfix">
				<div id="reportes" class="fila clearfix">
				</div><!-- fin fila -->
			</section>
			<footer>
			</footer>
		</div><!--!/#wrapper -->
    </div><!--!/#container -->
<script type="text/javascript">
$(document).ready(function() {
	loaded = false;
	counter = 0;
	var h = 0;
	$.couch.allDbs({
      		success : function(dbs) {
        	  dbs.filter(function(db_name){
        	      return db_name.search(/^_/) < 0 && db_name.search("reports") < 0;})
        	  .forEach(function(db) {
                      $("#sec #nav").prepend('<li><a class="ws" href="'+db+'">'+db+'</a></li>');
        	      if(counter == 0) {
        	      	var iframes = get_iframes(db);
			$("#reportes").append(iframes);
		      }
        	      counter +=1;
	        });
	        if(counter < 1) { 
	            $("#reportes").empty();
	              $("#reportes").append("<div id=\"no-workspace\" class=\"workspace\">No Workspaces installed, please start working to get some data</div><!-- .workspace -->");
		}
        	$("aside").height($("#main").height()+40);
	      }
	});
	$(document).on("click", "a.ws", function(e) {
		e.preventDefault();
		$("#reportes").empty().append(get_iframes($(this).attr("href")));
	});
});
function get_iframes(db) {
	var iframes = [];
	reports.forEach(function(rep) {
		var iframe = "/reports/_design/reports/reports/"+rep+".html?workspace="+db+"&design="+designs[rep]+"&view="+views[rep];
		iframes.push("<iframe class=\"iframe\" src="+iframe+" width=\"800\" height=\"500\"></iframe>");
	});
	var ret = "<div id=\"workspace-"+db+"\" class=\"workspace\"><h2>"+
		db+"</h2>"+iframes.join("")+"</div><!-- .workspace -->";
	return ret;
}
</script>

</body>
</html>
